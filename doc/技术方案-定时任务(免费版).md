# 方案：GitHub Actions 定时触发 (免费版最佳实践)

由于 Vercel Hobby (免费版) 每天仅允许执行 1 次 Cron Job，无法满足我们“每几分钟检查一次状态”的需求。
因此，我们利用 **GitHub Actions** 的免费额度（每月 2000 分钟，足够每 10 分钟跑一次）来充当定时触发器。

---

## 1. 原理
1.  **GitHub Actions**: 就像一个免费的云端服务器，我们设置它每 10 分钟醒来一次。
2.  **Curl 命令**: 醒来后，它执行一个简单的命令：访问你的网站接口 `https://your-app.com/api/cron/reconcile`。
3.  **鉴权**: 为了防止陌生人乱访问，我们在请求头里带上一个密码 (`CRON_SECRET`)，你的接口只认这个密码。

---

## 2. 实施步骤

### 第一步：创建 Workflow 文件
在你的项目根目录下，创建文件 `.github/workflows/cron.yml`。
*(我已经为您创建好了这个文件，内容如下)*

```yaml
name: Cron Job Reconcile

on:
  schedule:
    # 每 10 分钟运行一次
    - cron: '*/10 * * * *'
  workflow_dispatch: # 允许你在 GitHub 页面上手动点按钮触发

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
      - name: Call Reconcile API
        run: |
          curl -X GET ${{ secrets.APP_URL }}/api/cron/reconcile \
          -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
          --fail
```

### 第二步：配置 GitHub Secrets
你需要去你的 GitHub 仓库页面配置两个“密码”，这样 Actions 才能知道往哪里发请求，以及带什么密钥。

1.  进入你的 GitHub 仓库 -> **Settings** -> **Secrets and variables** -> **Actions**。
2.  点击 **New repository secret**，添加以下两个变量：

    *   **Name**: `APP_URL`
        *   **Value**: 你的 Vercel 部署域名 (例如: `https://degen-tempo.vercel.app`，注意不要带末尾的斜杠)
    
    *   **Name**: `CRON_SECRET`
        *   **Value**: 一个你自己生成的复杂密码 (例如: `my-super-secret-password-123`)。
        *   *注意：这个密码也要同时配置在 Vercel 的环境变量里，名字也叫 `CRON_SECRET`，值要一模一样。*

### 第三步：代码层面的配合
确保你的 API 路由 (`app/api/cron/reconcile/route.ts`) 里有鉴权逻辑：

```typescript
export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  // 校验请求头里的 Bearer Token 是否等于环境变量里的 CRON_SECRET
  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
    return new NextResponse('Unauthorized', { status: 401 });
  }
  
  // ... 你的业务逻辑 ...
}
```

---

## 3. 为什么这个方案好？
1.  **完全免费**: GitHub Actions 的免费额度对于这种轻量级请求是用不完的。
2.  **简单可靠**: 不依赖复杂的云服务，只要 GitHub 不挂，它就跑。
3.  **解耦**: 你的核心业务逻辑在 API 里，触发器是谁并不重要，未来你想换成 Vercel Pro 或者其他服务，改改触发源就行，代码不用动。
